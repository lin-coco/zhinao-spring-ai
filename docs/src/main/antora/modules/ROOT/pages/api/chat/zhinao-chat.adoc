= Zhinao AI Chat
:page-title: Zhinao AI Chat
:toc: left
:tabsize: 2
:sectnums:

The Zhinao AI Java Client supports the various AI language models from Zhinao AI. You can interact with Zhinao AI language models and create a multilingual conversational assistant based on Zhinao models.

== Prerequisites

You will need to create an API key with Zhinao to access Zhinao AI language models.
Create an account at https://ai.360.com/platform[Zhinao AI registration page] and generate the token on the https://ai.360.com/platform/keys[API Keys page].

The library uses your API key to authenticate with the Zhinao API. You can set this as an environment variable:

[source,shell]
----
export ZHINAO_API_KEY=<INSERT KEY HERE>
----

== Adding the Library to Your Project

=== Maven

Add the following dependency to your `pom.xml`:

[source,xml]
----
<dependency>
    <groupId>org.springaicommunity</groupId>
    <artifactId>zhinao-core</artifactId>
    <version>last-version</version>
</dependency>
----

=== Gradle

Add the following dependency to your `build.gradle`:

[source,groovy]
----
dependencies {
    implementation 'com.lincoco.springai:zhinao-core:last-version'
}
----

== Basic Usage

The following example demonstrates how to use the Zhinao AI Java Client to interact with the Zhinao Chat API:

[source,java]
----
// Create the Zhinao API client with your API key
String apiKey = System.getenv("ZHINAO_API_KEY");
ZhinaoApi zhinaoApi = new ZhinaoApi(apiKey);

// Create the chat model with custom options
var chatModel = new ZhinaoChatModel(zhinaoApi, ZhinaoChatOptions.builder()
        .model(ZhinaoApi.ChatModel.GPT_PRO.getValue())
        .temperature(0.4)
        .maxTokens(200)
        .build());

// Create a prompt with a user message
UserMessage userMessage = new UserMessage("Generate the names of 5 famous pirates.");
Prompt prompt = new Prompt(userMessage);

// Get the response
ChatResponse response = chatModel.call(prompt);
System.out.println(response.getResult().getOutput().getContent());
----

== Streaming Responses

You can also receive streaming responses from the Zhinao API:

[source,java]
----
// Create a prompt with a user message
UserMessage userMessage = new UserMessage("Tell me a long story about space exploration.");
Prompt prompt = new Prompt(userMessage);

// Get streaming response
Flux<ChatResponse> streamResponse = chatModel.stream(prompt);

// Process the streaming response
streamResponse.subscribe(
    chunk -> System.out.print(chunk.getResult().getOutput().getContent()),
    error -> System.err.println("Error: " + error.getMessage()),
    () -> System.out.println("\nStream completed.")
);
----

== Chat Options

The `ZhinaoChatOptions` class provides various configuration options for the chat API. These options can be set when creating the chat model or when sending individual prompts.

[cols="3,5,1", stripes=even]
|====
| Option | Description | Default

| model | The Zhinao Chat model to use (`zhinao-v1-8k`, `zhinao-v1-32k`, or `zhinao-v1-128k`) | `zhinao-v1-8k`
| maxTokens | The maximum number of tokens to generate | -
| temperature | Controls the randomness of the output (0.0-1.0) | 0.7
| topP | Controls the diversity via nucleus sampling (0.0-1.0) | 1.0
| n | Number of chat completions to generate per message | 1
| presencePenalty | Penalizes new tokens based on whether they appear in the text so far (-2.0 to 2.0) | 0.0
| frequencyPenalty | Penalizes new tokens based on their frequency in the text so far (-2.0 to 2.0) | 0.0
| stop | Up to 5 sequences where the API will stop generating further tokens | -
|====

=== Setting Default Options

You can set default options when creating the chat model:

[source,java]
----
ZhinaoChatOptions options = ZhinaoChatOptions.builder()
    .model(ZhinaoApi.ChatModel.ZHINAO_V1_32K.getValue())
    .temperature(0.5)
    .maxTokens(500)
    .build();

ZhinaoChatModel chatModel = new ZhinaoChatModel(zhinaoApi, options);
----

=== Overriding Options for a Specific Prompt

You can override the default options for a specific prompt:

[source,java]
----
ChatResponse response = chatModel.call(
    new Prompt(
        "Generate the names of 5 famous pirates.",
        ZhinaoChatOptions.builder()
            .model(ZhinaoApi.ChatModel.GPT_PRO.getValue())
            .temperature(0.8)
            .build()
    ));
----

== Low-level Zhinao API Client

The `ZhinaoApi` provides a lightweight Java client for the https://platform.zhinao.cn/docs/api-reference[Zhinao AI API].

Here's an example of using the API directly:

[source,java]
----
ZhinaoApi zhinaoApi = new ZhinaoApi(System.getenv("ZHINAO_API_KEY"));

ChatCompletionMessage chatCompletionMessage =
    new ChatCompletionMessage("Hello world", Role.USER);

// Synchronous request
ResponseEntity<ChatCompletion> response = zhinaoApi.chatCompletionEntity(
    new ChatCompletionRequest(List.of(chatCompletionMessage), 
        ZhinaoApi.ChatModel.GPT_PRO.getValue(), 0.7, false));

// Streaming request
Flux<ChatCompletionChunk> streamResponse = zhinaoApi.chatCompletionStream(
    new ChatCompletionRequest(List.of(chatCompletionMessage), 
        ZhinaoApi.ChatModel.GPT_PRO.getValue(), 0.7, true));
----

== Handling Errors and Retries

The Zhinao AI Java Client includes a retry mechanism to handle transient errors. By default, it uses a retry template with exponential backoff.

You can customize the retry behavior by providing your own `RetryTemplate`:

[source,java]
----
// Create a custom retry template
RetryTemplate retryTemplate = RetryUtils.getRetryTemplate(
    10,                   // maxAttempts
    2000,                 // initialInterval (ms)
    5,                    // multiplier
    180000,               // maxInterval (ms)
    false,                // retryClientErrors
    new int[]{},          // excludeStatusCodes
    new int[]{500, 502}   // includeStatusCodes
);

// Create the function callback resolver
FunctionCallbackResolver functionCallbackResolver = new FunctionCallbackResolver();

// Create the chat model with custom retry behavior
ZhinaoChatModel chatModel = new ZhinaoChatModel(
    zhinaoApi, 
    options, 
    functionCallbackResolver, 
    retryTemplate
);
----

== Further Examples

For more advanced examples, including function calling, refer to the xref:api/chat/functions/zhinao-chat-functions.adoc[Function Calling] documentation.